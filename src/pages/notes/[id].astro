---
import Layout from "../../layouts/Layout.astro";
import { supabase } from "../../lib/supabase";
import type { Note } from "../../types/note";

const { id } = Astro.params;

const { data: note, error } = await supabase
    .from("notes")
    .select("*")
    .eq("id", id)
    .single();

if (error) {
    console.error("Error fetching note:", error);
}
---

<Layout title={note ? `Note: ${note.id}` : "Note Not Found"}>
    {error && <p>Error loading note: {error.message}</p>}
    {
        note && (
            <div>
                <h1>Note: {note.id}</h1>
                <p>
                    <strong>Content:</strong> {note.content}
                </p>
                <p>
                    <strong>POV Type:</strong> {note.pov_type}
                </p>
                <p>
                    <strong>Narrator Trustworthiness:</strong>{" "}
                    {note.narrator_trustworthiness || "N/A"}
                </p>
                <p>
                    <strong>Epistemic Anomalies:</strong>{" "}
                    {note.epistemic_anomalies || "N/A"}
                </p>
                <p>
                    <strong>Narration Nodes:</strong>
                </p>
                <ul>
                    {note.narration_nodes &&
                        note.narration_nodes.map(
                            (node: {
                                element: string;
                                description: string;
                            }) => (
                                <li>
                                    {node.element}: {node.description}
                                </li>
                            ),
                        )}
                </ul>
                <p>
                    <strong>Tags:</strong> {note.tags.join(", ")}
                </p>
                <p>
                    <strong>Sequence Position:</strong>{" "}
                    {note.sequence_position || "N/A"}
                </p>
                <p>
                    <strong>Source:</strong> {note.source || "N/A"}
                </p>
                <p>
                    <strong>Created At:</strong>{" "}
                    {new Date(note.created_at).toLocaleString()}
                </p>
                <p>
                    <strong>Updated At:</strong>{" "}
                    {new Date(note.updated_at).toLocaleString()}
                </p>
                <a href={`/notes/${note.id}/edit`}>Edit Note</a>
            </div>
        )
    }
    <a href="/">Back to Home</a>
</Layout>

<style>
    a {
        display: inline-block;
        margin-top: 1rem;
        padding: 0.5rem 1rem;
        background-color: #4a4a4a;
        color: white;
        text-decoration: none;
        border-radius: 4px;
    }
    a:hover {
        background-color: #3a3a3a;
    }
</style>
